
## Короткий ответ

После выполнения `selfdestruct` контракт удаляется из блокчейна, его баланс отправляется на указанный адрес, а bytecode заменяется на пустой. Все оставшиеся средства контракта передаются получателю, и дальнейшие вызовы контракта завершатся ошибкой.

---

## Подробный разбор

### **Что происходит после выполнения `selfdestruct`?**
1. **Определение:**
   - `Selfdestruct` — это низкоуровневая операция, которая удаляет контракт из блокчейна.
   - Остаточный баланс контракта отправляется на указанный адрес.

2. **Пример:**
   ```solidity
   contract Example {
       function destroy(address payable recipient) public {
           selfdestruct(recipient);
       }
   }
   ```

   - В этом примере:
     - Контракт удаляется, а его баланс отправляется на адрес `recipient`.

3. **Технические детали:**
   - На уровне EVM `selfdestruct` выполняется через инструкцию `SELFDESTRUCT`.
   - Bytecode контракта заменяется на пустой.
   - Storage контракта удаляется.

4. **Особенности:**
   - После выполнения `selfdestruct` контракт больше не существует.
   - Дальнейшие вызовы контракта завершатся ошибкой.

5. **Подводные камни:**
   - Если контракт содержит важные данные или средства, их можно потерять.
   - Удаление контракта может привести к проблемам для зависимых систем.

---

### **Как это работает на уровне EVM?**
1. **SELFDESTRUCT Instruction:**
   - На уровне EVM `selfdestruct` выполняется через инструкцию `SELFDESTRUCT`.
   - Баланс контракта отправляется на указанный адрес.
   - Bytecode и storage контракта удаляются.

2. **Gas Costs:**
   - Выполнение `selfdestruct` возвращает часть газа за освобождение storage.
   - Однако отправка средств может потребовать дополнительного газа.

---

### **Пример комбинированного использования**
```solidity
contract Bank {
    uint public balance;

    function deposit() public payable {
        balance += msg.value;
    }

    function destroy(address payable recipient) public {
        selfdestruct(recipient); // Удаление контракта и отправка средств
    }
}
```

- В этом примере:
  - Функция `destroy` удаляет контракт и отправляет все средства на адрес `recipient`.

---

### **Последствия выполнения `selfdestruct`**
1. **Удаление контракта:**
   - Контракт больше не существует в блокчейне.
   - Его bytecode заменяется на пустой.

2. **Отправка средств:**
   - Остаточный баланс контракта отправляется на указанный адрес.
   - Если адрес недействителен, средства могут быть потеряны.

3. **Дальнейшие вызовы:**
   - Любые попытки взаимодействия с удаленным контрактом завершатся ошибкой.

---

### **Когда стоит использовать `selfdestruct`?**
1. **Сценарии использования:**
   - Для очистки неиспользуемых контрактов и освобождения storage.
   - Для возврата средств с контракта.

2. **Пример:**
   ```solidity
   contract Temporary {
       address payable owner;

       constructor() {
           owner = payable(msg.sender);
       }

       function cleanup() public {
           require(msg.sender == owner, "Not the owner");
           selfdestruct(owner); // Удаление контракта и возврат средств
       }
   }
   ```

   - В этом примере:
     - Владелец может удалить контракт и вернуть средства.

3. **Особенности:**
   - Использование `selfdestruct` должно быть тщательно обдумано.
   - Убедитесь, что контракт больше не нужен.

---

## Связанные темы
- [Вернуться к списку вопросов](5.%20Список%20вопросов.md)
- [[Чем опасен delegatecall?]]
- [[Если контракт не имеет payable функций, можно ли на него отправить Ether?]]

---

## Источники
- [Solidity Documentation - Selfdestruct](https://docs.soliditylang.org/en/latest/introduction-to-smart-contracts.html#self-destruct)
- [Understanding Selfdestruct in Solidity](https://ethereum.stackexchange.com/questions/81994/what-is-the-difference-between-fallback-and-receive-functions-in-solidity)
---
