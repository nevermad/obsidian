
## Короткий ответ

В Solidity `constant` и `immutable` переменные используются для определения неизменяемых значений. `constant` переменные должны быть инициализированы во время компиляции, а `immutable` — во время развертывания контракта. Эти переменные экономят газ, так как их значения хранятся непосредственно в байт-коде контракта.

---

## Подробный разбор

### **Constant**
1. **Определение:**
   - Переменные, объявленные как `constant`, должны быть инициализированы во время компиляции.
   - Значение `constant` переменной нельзя изменить после объявления.

2. **Пример:**
   ```solidity
   uint constant MAX_SUPPLY = 1000;
   ```

3. **Технические детали:**
   - Значение `constant` переменной встраивается непосредственно в байт-код контракта.
   - Это означает, что при каждом обращении к переменной значение берется из байт-кода, а не из `storage`.
   - Пример использования:
     ```solidity
     function getSupplyLimit() public pure returns (uint) {
         return MAX_SUPPLY; // Значение берется из байт-кода
     }
     ```

4. **Особенности:**
   - Использование `constant` переменных экономит газ, так как они не занимают место в `storage`.
   - Поддерживаются только для value types (например, `uint`, `bool`, `address`).

5. **Подводные камни:**
   - Значение должно быть известно во время компиляции, что ограничивает использование динамических данных.
   - Нельзя использовать для данных, которые зависят от состояния контракта или внешних факторов.

---

### **Immutable**
1. **Определение:**
   - Переменные, объявленные как `immutable`, могут быть инициализированы только один раз во время развертывания контракта.
   - После инициализации значение `immutable` переменной нельзя изменить.

2. **Пример:**
   ```solidity
   address immutable OWNER;

   constructor() {
       OWNER = msg.sender; // Инициализация во время развертывания
   }
   ```

3. **Технические детали:**
   - Значение `immutable` переменной также встраивается в байт-код контракта, но инициализируется во время выполнения конструктора.
   - Это позволяет использовать динамические данные (например, адрес развертывания).
   - Пример использования:
     ```solidity
     function getOwner() public view returns (address) {
         return OWNER; // Значение берется из байт-кода
     }
     ```

4. **Особенности:**
   - Использование `immutable` переменных экономит газ, так как они не занимают место в `storage`.
   - Поддерживаются только для value types.

5. **Подводные камни:**
   - Значение должно быть установлено в конструкторе, что требует осторожности при развертывании контракта.
   - Нельзя изменить значение после развертывания, даже если это необходимо.

---

### **Сравнение `constant` и `immutable`**
| Характеристика      | `constant`                          | `immutable`                        |
|---------------------|-------------------------------------|------------------------------------|
| **Инициализация**   | Во время компиляции                | Во время развертывания            |
| **Значение**        | Должно быть известно заранее       | Может зависеть от динамических данных |
| **Хранение**        | В байт-коде                       | В байт-коде                      |
| **Газовые затраты** | Очень низкие                      | Низкие                           |

---

### **Пример комбинированного использования**
```solidity
contract Example {
    uint constant MAX_SUPPLY = 1000;
    address immutable OWNER;

    constructor() {
        OWNER = msg.sender;
    }

    function getMaxSupply() public pure returns (uint) {
        return MAX_SUPPLY; // Значение берется из байт-кода
    }

    function getOwner() public view returns (address) {
        return OWNER; // Значение берется из байт-кода
    }
}
```

- В этом примере:
  - `MAX_SUPPLY` — это `constant` переменная, значение которой известно во время компиляции.
  - `OWNER` — это `immutable` переменная, значение которой устанавливается во время развертывания.

---

## Связанные темы
- [Вернуться к списку вопросов](5.%20Список%20вопросов.md)
- [[Как работают модификаторы изменения состояния pure, view на уровне Solidity? Какие нюансы на уровне байткода EVM?]]
- [[Как расcчитывается номер слота для хранения переменных смарт-контракта?]]
- [[Что такое упаковка структур? Приведите примеры.]]

---

## Источники
- [Solidity Documentation - Constants and Immutables](https://docs.soliditylang.org/en/latest/contracts.html#constant-and-immutable-state-variables)
- [Understanding Constant and Immutable Variables in Solidity](https://ethereum.stackexchange.com/questions/96389/what-is-the-difference-between-constant-and-immutable-in-solidity)
---
