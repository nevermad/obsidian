---
title: Когда еще Nonce увеличивается помимо исполнения транзакции?
tags: [EVM, Ethereum, Аккаунты, Nonce, Транзакции, Контракты]
---

## Короткий ответ

Помимо исполнения транзакций, nonce EOA увеличивается при **создании нового контракта**. Nonce контракта увеличивается при **создании нового контракта этим контрактом**.


## Подробный разбор

Мы уже знаем, что nonce EOA увеличивается при каждой успешно выполненной транзакции. Однако, существует еще один случай, когда nonce EOA увеличивается:

**1. Создание контракта:**

Когда EOA инициирует транзакцию для создания нового смарт-контракта, nonce этого EOA также увеличивается.  Это происходит потому, что создание контракта само по себе является транзакцией, требующей подписи и включения в блок.  Даже если в процессе развертывания контракта произойдет ошибка, nonce EOA все равно будет увеличен.

**Nonce Контрактов:**

Важно помнить, что контракты также имеют nonce.  Однако, в отличие от EOA, nonce контракта увеличивается **только при создании нового контракта этим контрактом**.  Выполнение функций контракта не влияет на его nonce.  Это позволяет отслеживать, сколько контрактов было создано данным контрактом.  

**Случай с атакой и заменой кода контракта:**

В крайне редких и сложных сценариях атаки, если злоумышленнику удается получить контроль над контрактом и **заменить его код**, он теоретически может **искусственно манипулировать nonce** этого контракта.  Это возможно, если новый код контракта содержит логику, которая изменяет nonce произвольным образом.

**Важные оговорки:**

* **Крайне маловероятно:**  Этот сценарий  *чрезвычайно* сложен в реализации на практике, так как требует успешного взлома контракта и обхода всех мер безопасности (например, многоподписных кошельков, аудита кода и т.д.).
* **Нестандартное поведение:** Манипулирование nonce контракта таким образом является нестандартным поведением и противоречит предполагаемому использованию nonce.
* **Последствия для безопасности:**  Если атака такого рода будет успешной, она может иметь серьезные последствия для безопасности контракта и средств, связанных с ним.


**В стандартных условиях и при правильной реализации контрактов,  nonce контракта увеличивается *исключительно* при создании новых контрактов.**  Случай с атакой и заменой кода является исключением,  который теоретически возможен, но крайне маловероятен на практике.


## Пример

Представьте, что у вас есть EOA с nonce = 5.  Вы отправляете транзакцию для создания нового контракта.  Даже если развертывание контракта завершится неудачно (например, из-за ошибки в коде), nonce вашего EOA увеличится до 6.   Если этот же EOA затем успешно отправит обычную транзакцию,  ее nonce должен быть равен 6.


## Связанные темы

* [Вернуться к списку вопросов](4.%20Список%20вопросов.md)
* [[Что такое Nonce в состоянии аккаунта?]]
* [[Почему Nonce увеличивается после каждой транзакции?]]
* [[Что такое SmartContract? Может ли иметь приватный ключ? Может ли хранить произвольные данные ? Может ли хранить код? Кто контролирует аккаунт?]]
* [[Как транзакция выполняется на уровне EVM? Может ли измениться code storage аккаунта? Что происходит со storage аккаунта?]]


---