---
title: Proxy Pattern в Ethereum
tags: [EVM, Ethereum, Smart Contract, Proxy Pattern, Изменчивость кода, Безопасность]
---

## Короткий ответ

Proxy Pattern - это шаблон проектирования в Ethereum, позволяющий создавать смарт-контракты с обновляемой логикой путем разделения данных и логики на разные контракты: **proxy contract** и **implementation contract**.


## Подробный разбор

**Proxy Pattern**  - это распространенный способ обхода ограничения неизменности кода смарт-контрактов в Ethereum. Он позволяет обновлять логику контракта без необходимости переразвертывания и изменения его адреса.  Это достигается за счет разделения функциональности на два контракта:

**1. Proxy Contract (Прокси-контракт):**

* Хранит адрес **implementation contract**.
* Принимает вызовы от пользователей и **делегирует** их implementation contract.
* **Не содержит бизнес-логики**, а только логику перенаправления вызовов.
* Имеет **постоянный адрес**, который используется пользователями для взаимодействия с контрактом.  


**2. Implementation Contract (Контракт реализации):**

* Содержит **фактическую бизнес-логику** смарт-контракта.
* Может быть **заменен** на новый контракт с обновленной логикой.


**Как работает обновление:**

1. Развертывается **новый implementation contract** с измененной логикой.
2. В **proxy contract**  изменяется  **адрес implementation contract**,  указывая на новый контракт.  Это обычно делается через специальную функцию в proxy contract, доступную только владельцу или управляющему аккаунту.


**Типы Proxy Pattern:**

Существуют различные типы Proxy Pattern, каждый со своими особенностями и компромиссами:

* **DelegateCall Proxy:**  Использует low-level call `delegatecall` для выполнения кода implementation contract в контексте proxy contract.
* **Storage Proxy:** Разделяет storage между proxy и implementation contract.
* **Upgradeability Plugins:**  Специализированные библиотеки и фреймворки, упрощающие создание и управление upgradable proxies. (OpenZeppelin Upgrades)


**Преимущества:**

* **Обновляемая логика:** Позволяет исправлять ошибки и добавлять новые функции без переразвертывания контракта.
* **Постоянный адрес:**  Пользователи продолжают взаимодействовать с тем же адресом контракта, даже после обновления логики.


**Недостатки:**

* **Сложность:**  Архитектура proxy pattern более сложная, чем у обычных контрактов.
* **Потенциальные уязвимости:**  Неправильная реализация proxy pattern может привести к уязвимостям в безопасности.


## Связанные темы

* [Вернуться к списку вопросов](4.%20Список%20вопросов.md)
* [[Можно ли изменить код контракта?]]
* [[Можно ли сделать контракт изменяемым?]]
* [[Какие преимущества и недостатки есть у неизменности контрактов?]]

## Источники

* [OpenZeppelin Upgrades: Secure and Transparent Contract Upgrades](https://docs.openzeppelin.com/upgrades-plugins/1.x/)


---