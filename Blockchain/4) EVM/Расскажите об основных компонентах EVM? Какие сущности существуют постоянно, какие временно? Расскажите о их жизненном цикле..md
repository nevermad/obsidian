---
title: Основные компоненты EVM
tags: [EVM, Ethereum, Архитектура EVM, Компоненты EVM, State Trie, Gas, Stack, Memory, Storage]
---
## Короткий ответ

Основные компоненты EVM: **стек**, **память**, **хранилище**, **Program Counter**, **gas counter**. **State Trie**  существует постоянно, остальные компоненты создаются для каждой транзакции и уничтожаются после ее выполнения.

![[Pasted image 20241213174932.png]]
## Подробный разбор

EVM (Ethereum Virtual Machine) - это  state machine (конечный автомат),  который выполняет smart contracts (смарт-контракты) в сети Ethereum.  Он имеет следующие основные компоненты:

**1. Стек (Stack):**

* **LIFO (Last-In, First-Out):** Стек - это структура данных типа LIFO, используемая для хранения операндов и промежуточных результатов вычислений.  (см. [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован stack.]])
* **Ограниченный размер:** Стек EVM имеет ограниченный размер - 1024 элемента.

**2. Память (Memory):**

* **Byte-addressable array:** Память - это  byte-addressable array (массив с байтовой адресацией),  используемый для временного хранения данных во время выполнения транзакции.  (см. [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован memory.]])
* **Очищается после выполнения:** Память очищается после завершения выполнения транзакции.

**3. Хранилище (Storage):**

* **Persistent storage:** Хранилище - это  persistent storage area (постоянная область хранения)  для смарт-контрактов. Данные в хранилище сохраняются между вызовами функций и транзакциями.   (см. [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован storage.]])
* **Key-value store:** Хранилище представляет собой  key-value store (хранилище ключ-значение), где ключи и значения - это 256-битные числа.

**4. Program Counter (Счетчик команд):**

* **Текущая инструкция:** Program Counter указывает на текущую выполняемую инструкцию (opcode) в bytecode контракта.


**5. Gas Counter (Счетчик газа):**

* **Отслеживание gas:** Gas Counter отслеживает remaining gas (оставшийся газ) для выполнения транзакции.


**6. State Trie (Дерево состояний):**

* **Глобальное состояние:** State Trie - это  Merkle Patricia Trie,  который хранит глобальное состояние  блокчейна Ethereum,  включая балансы аккаунтов,  nonce  и  storage контрактов.
* **Persistent (Постоянный):** State Trie  существует постоянно и обновляется после каждой транзакции.

**Жизненный цикл компонентов:**

* **State Trie:**  Существует постоянно.
* **Стек, память, Program Counter, Gas Counter:** Создаются для каждой транзакции и уничтожаются после ее завершения.


## Связанные темы

* [Вернуться к списку вопросов](4.%20Список%20вопросов.md)
* [[Как транзакция выполняется на уровне EVM? Может ли измениться code storage аккаунта? Что происходит со storage аккаунта?]]
* [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован stack.]]
* [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован memory.]]
* [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован storage.]]
* [[State Trie]]


## Источники

* [Ethereum Documentation - EVM](https://ethereum.org/en/developers/docs/evm/)
* [Yellow Paper - EVM](https://ethereum.github.io/yellowpaper/paper.pdf#page=12)


---