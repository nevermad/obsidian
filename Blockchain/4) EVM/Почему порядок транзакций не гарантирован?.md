---
title: Почему порядок транзакций не гарантирован?
tags: [EVM, Ethereum, Транзакции, Порядок транзакций, Майнинг, Mempool]
---
## Короткий ответ

Порядок транзакций в Ethereum не гарантирован, так как валидароты имеют право выбирать, какие транзакции включать в блок и в каком порядке.  Это зависит от **gas price**, стратегии валидации и других факторов.

![[Pasted image 20241213173452.png]]


## Подробный разбор

## ороткий ответ

Порядок транзакций в Ethereum не гарантирован, так как **валидаторы**, а не майнеры, имеют право выбирать, какие транзакции включать в блок и в каком порядке. Это зависит от **gas price**, **MEV (Miner/Maximal Extractable Value)**, стратегии валидатора и других факторов. Хотя термин "MEV" исторически связан с майнерами, он сохранился и в контексте PoS, и теперь чаще расшифровывается как **Maximal Extractable Value**.

## Подробный разбор

**Mempool (пул памяти):**

Как и раньше, транзакции сначала попадают в mempool - очередь ожидающих транзакций.  **Валидаторы**, а не майнеры, выбирают транзакции из mempool для включения в блоки.

**Выбор валидаторов:**

Валидаторы, выбранные для предложения блока, имеют право упорядочивать транзакции по своему усмотрению. На выбор влияют:

- **Gas Price:** Более высокий gas price по-прежнему стимулирует валидаторов включать транзакцию в блок раньше.
    
- **MEV (Maximal Extractable Value):** Валидаторы могут извлекать дополнительную прибыль, упорядочивая транзакции определенным образом. Это может включать в себя front-running, sandwich атаки и другие стратегии. MEV является значительным фактором, влияющим на порядок транзакций.
    
- **Размер транзакции:** Валидаторы могут отдавать предпочтение более компактным транзакциям, чтобы вместить больше транзакций в блок.
    
- **Стратегия валидатора:** Разные валидаторы могут использовать разные стратегии выбора и упорядочивания транзакций.
    
**Влияние на смарт-контракты:**

Разработчики смарт-контрактов должны учитывать MEV и отсутствие гарантированного порядка транзакций при проектировании своих контрактов.

**Front-running (опережение):**

Отсутствие гарантированного порядка транзакций может привести к **front-running** - это тип атаки, при которой злоумышленник отслеживает транзакции в mempool и вставляет свою собственную транзакцию с более высоким gas price перед целевой транзакцией,  чтобы получить преимущество.  

## Связанные темы

* [Вернуться к списку вопросов](4.%20Список%20вопросов.md)
* [[В чем различие Gas Price и Gas Limit?]]
* [[Как транзакция выполняется на уровне EVM? Может ли измениться code storage аккаунта? Что происходит со storage аккаунта?]]

## Источники

* [Ethereum Documentation - Transactions](https://ethereum.org/en/developers/docs/transactions/)
* [Ethereum Stack Exchange - Why is transaction order not guaranteed?](https://ethereum.stackexchange.com/questions/1359/why-is-transaction-order-not-guaranteed)
* [Blocknative - Ethereum Transaction Lifecycle](https://www.blocknative.com/blog/ethereum-transaction-lifecycle)


---