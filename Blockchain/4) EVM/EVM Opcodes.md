---
title: EVM Opcodes для работы со Storage
tags:
  - EVM
  - Ethereum
  - Opcodes
  - Storage
  - SLOAD
  - SSTORE
---
## Короткий ответ

Основные опкоды для работы со storage: `SLOAD` (чтение данных) и `SSTORE` (запись данных).  Они используются для взаимодействия со storage смарт-контракта.

## Подробный разбор

Storage в EVM, как мы уже знаем из [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован storage.]], представляет собой persistent key-value store (постоянное хранилище ключ-значение). Для взаимодействия с ним используются следующие основные опкоды:

**1. `SLOAD` (Storage Load):**

* **Чтение данных:** `SLOAD`  читает данные из storage.
* **Аргументы:**  Принимает один аргумент -  `key` (ключ) -  256-битное значение, указывающее на  storage slot (слот хранилища), из которого нужно прочитать данные.  `key`  должен быть на вершине стека.
* **Результат:**  `SLOAD`  снимает `key` со стека и помещает на вершину стека  `value` (значение) - 256-битное значение, хранящееся в указанном слоте.  Если слот не был previously written to (ранее записан),  возвращается 0.
* **Gas cost:** Чтение из storage относительно недорогое, но дороже, чем чтение из memory или stack.


**2. `SSTORE` (Storage Store):**

* **Запись данных:** `SSTORE` записывает данные в storage.
* **Аргументы:** Принимает два аргумента:
    * `key` (ключ) - 256-битное значение, указывающее на storage slot (слот хранилища), в который нужно записать данные.  `key` должен быть на вершине стека.
    * `value` (значение) -  256-битное значение, которое нужно записать в указанный слот. `value` должен быть вторым сверху в стеке.
* **Результат:** `SSTORE` снимает `key` и `value` со стека.
* **Gas cost:** Запись в storage -  **очень дорогая операция** в EVM.  Стоимость зависит от того,  изменяется ли значение в слоте  (более дорого) или слот записывается впервые или сбрасывается в ноль.


**Примеры:**

```assembly
; Чтение значения из слота 0
PUSH1 0x00    ; key = 0
SLOAD         ; value = storage[0]

; Запись значения 0x42 в слот 0x01
PUSH1 0x42    ; value = 0x42
PUSH1 0x01    ; key = 0x01
SSTORE        ; storage[0x01] = 0x42
```
**Другие Opcodes, связанные со Storage:**

Хотя `SLOAD` и `SSTORE` являются основными опкодами для работы со storage,  другие опкоды также косвенно взаимодействуют с хранилищем. Например:

* Opcodes, которые работают с  **mapping**  или  **dynamically-sized arrays**  в Solidity,  внутренне используют `SLOAD` и `SSTORE` для доступа к данным в storage.
* **`CREATE` and `CREATE2`:** Эти опкоды используются для создания новых контрактов, что приводит к изменению дерева состояний,  которое хранится в storage.
* **`SELFDESTRUCT`:**  Этот opcode уничтожает контракт и может изменить storage,  возвращая часть газа  и  очищая хранилище контракта.

## Связанные темы

* [Вернуться к списку вопросов](4.%20Список%20вопросов.md)
* [[Как транзакция выполняется на уровне EVM? Может ли измениться code storage аккаунта? Что происходит со storage аккаунта?]]
* [Полный список EVM Opcodes](https://www.ethervm.io/)


---