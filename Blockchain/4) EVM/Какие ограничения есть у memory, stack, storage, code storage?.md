---
title: Ограничения memory, stack, storage, code storage
tags: [EVM, Ethereum, Memory, Stack, Storage, Code Storage, Ограничения]
---
## Короткий ответ

`memory` и `stack` - временные, ограниченного размера; `storage` - постоянное, дорогое; `code storage` - постоянное, неизменяемое, доступно только для чтения.

## Подробный разбор


Каждый компонент EVM, используемый для хранения данных, имеет свои ограничения:

**1. Memory (Память):**

* **Временное хранилище:** Данные в памяти хранятся только во время выполнения транзакции и удаляются после ее завершения.
* **Линейная стоимость расширения:**  Стоимость расширения памяти растет линейно относительно ее размера.  Чрезмерное использование памяти может привести к  высоким затратам на газ.
* **Неограниченный размер (теоретически):**  Хотя размер памяти не ограничен фиксированным пределом,  ее расширение ограничено доступным газом.

**2. Stack (Стек):**

* **Временное хранилище:** Данные в стеке хранятся только во время выполнения транзакции и удаляются после ее завершения.
* **Фиксированный размер:** Стек EVM имеет фиксированный размер - **1024 элемента**.  Превышение этого лимита приведет к ошибке  `stack overflow`.
* **Ограниченный размер данных:** Каждый элемент стека может хранить значение размером до **256 бит**.


**3. Storage (Хранилище):**

* **Постоянное хранилище:** Данные в хранилище сохраняются  permanently (постоянно)  в блокчейне.
* **Высокая стоимость записи:** Запись данных в хранилище является  **самой дорогой операцией**  в EVM с точки зрения потребления газа.  Чтение данных из хранилища значительно дешевле.
* **256-битные слоты:** Хранилище организовано как массив 256-битных слотов,  адресуемых 256-битными ключами.

**4. Code Storage (Хранилище кода):**

* **Постоянное и неизменяемое:**  Хранит bytecode смарт-контракта.  Код  **не может быть изменен** после развертывания контракта. (см. [[Можно ли изменить код контракта?]])
* **Только для чтения:** Доступ к code storage  **только для чтения**.  Контракт не может изменять свой собственный код.
* **Стоимость чтения:** Чтение данных из code storage  имеет  ненулевую стоимость в gas, но дешевле, чем чтение из storage.
## Связанные темы

* [Вернуться к списку вопросов](4.%20Список%20вопросов.md)
* [[Расскажите об основных компонентах EVM? Какие сущности существуют постоянно, какие временно? Расскажите о их жизненном цикле.]]
* [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован stack.]]
* [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован memory.]]
* [[Расскажите о свойствах, особенностях, ограничениях, времени жизни информации, каким образом структурирован storage.]]



## Источники

* [Ethereum Yellow Paper - EVM](https://ethereum.github.io/yellowpaper/paper.pdf)
* [Solidity Documentation - Data Location](https://docs.soliditylang.org/en/v0.8.20/internals/layout_in_memory.html)


---