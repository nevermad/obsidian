---
title: Свойства и особенности Memory в EVM
tags: [EVM, Ethereum, Memory, Массивы, Время жизни, Ограничения, Gas]
---

## Короткий ответ

Memory в EVM - это **байтово-адресуемый массив**, используемый для временного хранения данных во время выполнения транзакции. Она очищается после завершения транзакции, и ее использование ограничено available gas (доступным газом).


## Подробный разбор


**Структура и организация:**

* **Байтово-адресуемый массив:** Memory представляет собой линейный массив, где каждый байт имеет unique address (уникальный адрес). Доступ к данным осуществляется по их byte offset (байтовому смещению) от начала массива.
* **Динамически расширяемая:** Размер memory может dynamically expand (динамически расширяться) во время выполнения транзакции, но это expansion consumes gas (расширение потребляет газ).
* **Временное хранилище:** Данные в memory существуют только  **во время выполнения транзакции**. После завершения транзакции memory  **полностью очищается**.


**Свойства и особенности:**

* **Дешевле storage:**  Стоимость чтения и записи данных в memory значительно **ниже**, чем в storage.  Это делает memory  preferable for temporary data (предпочтительным вариантом для временных данных), которые не нужно сохранять permanently (постоянно).
* **Используется для сложных данных:** Memory часто используется для работы с complex data structures (сложными структурами данных), такими как arrays, strings, structs,  которые не помещаются в stack (стек) EVM из-за его ограниченного размера.
* **Доступ через опкоды:** Доступ к данным в memory осуществляется с помощью specific opcodes (специальных опкодов), таких как `MLOAD` (чтение из memory), `MSTORE` (запись в memory), `MSTORE8` (запись одного байта в memory).


**Ограничения:**

* **Стоимость расширения:**  Стоимость расширения memory не fixed (не фиксированная), а рассчитывается по formula (формуле),  которая penalizes large memory allocations (штрафует большие выделения памяти). Это encourages developers to minimize memory usage (побуждает разработчиков минимизировать использование памяти).
* **Ограничено available gas:**  Хотя теоретически memory может быть very large (очень большой), ее размер practically limited (практически ограничен) available gas (доступным газом) для транзакции.  Если не хватает gas для расширения memory,  транзакция  reverts (отменяется).


**Примеры использования:**

* **Хранение dynamically sized arrays (динамически изменяемых массивов):**  Memory используется для хранения массивов, размер которых неизвестен на момент компиляции контракта.
* **Работа со строками:**  Строки variable length (переменной длины)  хранятся в memory.
* **Временные вычисления:** Memory используется для хранения intermediate results (промежуточных результатов)  complex calculations (сложных вычислений).



## Связанные темы

* [Вернуться к списку вопросов](4.%20Список%20вопросов.md)
* [[Расскажите об основных компонентах EVM? Какие сущности существуют постоянно, какие временно? Расскажите о их жизненном цикле.]]
* [[Какие ограничения есть у memory, stack, storage, code storage?]]
* [[Свойства и особенности Stack в EVM]]
* [[EVM Opcodes]] - Список и описание опкодов, работающих с memory.



## Источники

* [Ethereum Yellow Paper - EVM](https://ethereum.github.io/yellowpaper/paper.pdf#page=14) - Section 9.2 describes EVM Memory
* [Solidity Documentation - Data Location](https://docs.soliditylang.org/en/v0.8.20/internals/layout_in_memory.html)


---