---
title: Свойства и особенности Stack в EVM
tags: [EVM, Ethereum, Stack, LIFO, Ограничения, Время жизни, Глубина стека]
---

## Короткий ответ

Stack EVM - это структура данных **LIFO** (Last-In, First-Out) с ограничением в **1024 элемента** по 256 бит каждый.  Он используется для хранения операндов и промежуточных результатов вычислений и существует только во время выполнения транзакции.


## Подробный разбор

**Структура и организация:**

* **LIFO (Last-In, First-Out):**  Stack (стек) работает по принципу "последний вошел, первый вышел". Последний добавленный элемент (pushed) первым извлекается (popped). Аналогия - стопка тарелок: последняя положенная тарелка будет первой взятой.
* **256-битные слова (words):** Stack EVM хранит данные в виде 256-битных слов (words). Это fundamental data unit (фундаментальная единица данных) в EVM, соответствующая размеру слова в Ethereum.
* **Ограниченная глубина:** Максимальный размер стека - **1024 слова**. Превышение этого лимита вызывает ошибку `StackTooDeepException`, которая приводит к отмене транзакции и потере gas.


**Свойства и особенности:**

* **Быстрый доступ:** Операции с стеком (push, pop, dup, swap) очень быстрые и efficient (эффективные), так как стек находится в memory (памяти) EVM и доступ к нему direct (прямой).
* **Основа для вычислений:** Stack используется для хранения operands (операндов) и  intermediate results (промежуточных результатов) арифметических и логических операций.  Большинство опкодов EVM работают непосредственно со стеком, извлекая операнды из стека и помещая результат обратно в стек.
* **Временное хранилище:** Данные в стеке существуют только  **во время выполнения транзакции**.  После завершения выполнения, stack is cleared (стек очищается). Данные не persist between transactions (не сохраняются между транзакциями).


**Ограничения:**

* **Фиксированный размер:** Ограничение в 1024 элемента может быть проблемой для сложных смарт-контрактов, требующих больше stack space (места в стеке) для выполнения вычислений.  Разработчики должны оптимизировать код контрактов, чтобы minimize stack usage (минимизировать использование стека) и avoid stack overflow errors (избегать ошибок переполнения стека).
* **Только 256-битные слова:**  Stack может хранить только 256-битные значения.  Для работы с данными другого размера (например, strings или structs)  требуется conversion or decomposition into 256-bit chunks (преобразование или декомпозиция на 256-битные куски).


**Примеры использования опкодов:**

* **PUSH1 0x60:** Добавляет значение `0x60` на вершину стека.
* **ADD:** Снимает два верхних значения со стека, складывает их и помещает результат на вершину стека.
* **SWAP1:** Меняет местами верхний элемент стека со вторым сверху.
* **DUP1:** Дублирует верхний элемент стека.


## Связанные темы

* [Вернуться к списку вопросов](4.%20Список%20вопросов.md)
* [[Расскажите об основных компонентах EVM? Какие сущности существуют постоянно, какие временно? Расскажите о их жизненном цикле.]]
* [[Какие ограничения есть у memory, stack, storage, code storage?]]
* [[EVM Opcodes]] - Список и описание опкодов EVM.


## Источники

* [Ethereum Yellow Paper - EVM](https://ethereum.github.io/yellowpaper/paper.pdf#page=12)  - Section 9.1 describes the EVM Stack
* [EVM Opcodes](https://www.ethervm.io/) -  Provides details on opcodes that interact with the stack.



---