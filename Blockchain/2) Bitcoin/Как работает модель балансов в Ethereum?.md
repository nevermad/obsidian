
**Короткий ответ**: В модели балансов Ethereum для каждого адреса хранится текущее состояние (баланс). Балансы изменяются напрямую при выполнении транзакций и взаимодействии со смарт-контрактами, что отличается от модели UTXO, используемой в Bitcoin.

---

## Подробный разбор

### Основные понятия

1. **Состояния аккаунтов**:
   - Ethereum использует **аккаунты**, которые могут быть:
     - **EOA (Externally Owned Account)**: управляются приватными ключами.
     - **Контрактные аккаунты**: управляются кодом смарт-контракта.
   - Каждому аккаунту присваивается:
     - Баланс (в wei).
     - Код (если это контракт).
     - Состояние хранения (storage).

2. **База данных состояния**:
   - Узлы хранят текущее состояние всех аккаунтов.
   - Состояние обновляется с каждой транзакцией.

---

### Как работает модель балансов?

1. **Отправка транзакции**:
   - Отправитель указывает получателя и сумму перевода.
   - Если отправитель — EOA, транзакция подписывается приватным ключом.

2. **Обновление балансов**:
   - Баланс отправителя уменьшается на сумму перевода + комиссия за газ.
   - Баланс получателя увеличивается на сумму перевода.

3. **Взаимодействие со смарт-контрактами**:
   - Транзакция может вызывать функции смарт-контракта.
   - Изменения состояния контракта записываются в его storage.

---

### Отличие от UTXO модели

| Параметр                | Модель балансов (Ethereum)          | UTXO модель (Bitcoin)              |
|-------------------------|-------------------------------------|------------------------------------|
| Единицы учёта           | Балансы аккаунтов                  | Непотраченные выходы               |
| Обновление состояния    | Прямое изменение баланса           | Создание новых выходов             |
| Простота верификации    | Высокая                            | Умеренная                          |
| Гибкость                | Взаимодействие с контрактами       | Транзакции без программируемости   |

---

### Преимущества модели балансов

1. **Простота**:
   - Легко определить баланс аккаунта без сканирования блокчейна.

2. **Гибкость**:
   - Поддержка сложных операций и взаимодействий со смарт-контрактами.

3. **Меньший объём данных**:
   - Не требуется отслеживать множество выходов (UTXO).

---

### Недостатки модели балансов

1. **Менее безопасна для аудита**:
   - Прямая запись в баланс делает сложнее отслеживание всей истории операций.

2. **Зависимость от целостности состояния**:
   - Узлы должны хранить полное текущее состояние всех аккаунтов.

---

### Пример

1. **Аккаунты**:
   - Alice: 10 ETH.
   - Bob: 5 ETH.

2. **Транзакция**:
   - Alice отправляет 3 ETH Bob.
   - Комиссия за газ: 0.01 ETH.

3. **Результат**:
   - Баланс Alice: \(10 - 3 - 0.01 = 6.99\) ETH.
   - Баланс Bob: \(5 + 3 = 8\) ETH.

# Зачем нужен nonce в кошельке?

**Короткий ответ**: Nonce в кошельке используется для отслеживания и управления порядком транзакций. Это уникальное число для каждой транзакции, которое помогает предотвратить повторные отправки одной и той же транзакции и гарантирует правильный порядок их обработки.

---

## Подробный разбор

### Что такое nonce в кошельке?

1. **Определение Nonce**:
   - Nonce (от англ. "number used once") — это уникальное число, которое увеличивается с каждой отправленной транзакцией с одного и того же кошелька.
   - В Ethereum и других блокчейн-сетях nonce играет ключевую роль в правильной обработке транзакций.

2. **Роль nonce**:
   - В отличие от Bitcoin, где каждая транзакция может быть привязана к конкретному публичному ключу, в Ethereum каждая транзакция привязана к адресу и **nonce**.
   - Nonce используется для того, чтобы транзакции обрабатывались в правильном порядке, начиная с 0 и увеличиваясь на 1 с каждой отправленной транзакцией.

---

### Как работает nonce в кошельке?

1. **Транзакции с правильным порядком**:
   - Каждый раз, когда вы отправляете транзакцию с кошелька, увеличивается значение nonce.
   - Это гарантирует, что транзакции обрабатываются по порядку, а не в случайном.

2. **Пример**:
   - Если у вашего кошелька nonce = 3, то ваша следующая транзакция должна быть с nonce = 4.
   - Если транзакция с nonce = 4 не будет подтверждена сразу, но позже будет подтверждена транзакция с nonce = 3, эта транзакция будет отклонена как устаревшая.

3. **Проблемы без nonce**:
   - Если не отслеживать nonce, это может привести к дублированию транзакций, некорректному порядку обработки или атакам на сеть (например, повторные отправки).

---

### Для чего нужен nonce?

1. **Порядок транзакций**:
   - Nonce позволяет сети блокчейн точно отслеживать порядок транзакций, предотвращая их дублирование.
   - В Ethereum, если транзакция с nonce пропущена, следующая транзакция с более высоким значением nonce будет заблокирована до тех пор, пока не будет отправлена пропущенная транзакция.

2. **Безопасность**:
   - Nonce помогает защитить от атак, таких как **replay attack**, где одна и та же транзакция может быть повторно отправлена в сеть.

3. **Управление кошельком**:
   - Nonce даёт пользователю возможность отслеживать, какие транзакции были отправлены, и отслеживать прогресс отправленных средств.

---

### Проблемы с некорректным nonce

1. **Неправильный порядок**:
   - Если отправить транзакцию с неправильным nonce, сеть отклонит её, пока не будет получена транзакция с более низким номером.
   - Это важно для корректной работы смарт-контрактов и децентрализованных приложений (DApps).

2. **Поддержка в кошельке**:
   - Большинство современных кошельков автоматически отслеживают и увеличивают nonce, чтобы избежать проблем с транзакциями.

---

### Связанные темы
- [[Как работает модель балансов в Ethereum?]]
- [[Что такое Gas?]]
- [[Как происходит подпись и верификация сообщения? Какими ключами?]]

---

### Источники
1. [Ethereum Documentation: Nonce](https://ethereum.org/en/developers/docs/transactions/)
2. [What is Nonce in Ethereum?](https://www.coindesk.com/learn/what-is-nonce-in-ethereum)
3. [Understanding Ethereum Nonce](https://medium.com/@mycrypto/ethereum-nonces-explained-271d8921280e)

---

### Связанные темы
- [[Как работает UTXO модель в Bitcoin?]]
- [[Структура транзакций, какие поля имеются и для чего нужны?]]
- [[Какую математическую задачку решают майнеры в POW консенсусе? Что конкретно они делают и какие критерии правильности решения задачи?]]

---

### Источники
1. [Ethereum Whitepaper](https://ethereum.org/en/whitepaper/)
2. [Understanding Ethereum Accounts](https://ethereum.org/en/developers/docs/accounts/)
3. [Ethereum's Account Model Explained](https://medium.com/coinmonks/ethereum-account-model-explained-3fbd4a579a8)