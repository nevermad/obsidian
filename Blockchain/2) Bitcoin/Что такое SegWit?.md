
**Короткий ответ**: SegWit (Segregated Witness) — это обновление протокола Bitcoin, отделяющее подписи (witness data) от основной структуры транзакции. Это увеличивает пропускную способность сети, снижает риск атак на модификацию транзакций (transaction malleability) и позволяет внедрять новые функции, такие как Lightning Network.

---

## Подробный разбор

### Основная идея SegWit

1. **Отделение подписей**:
   - До SegWit подписи (цифровые подписи входов транзакции) были частью основной структуры транзакции.
   - SegWit перемещает эти данные в отдельное поле `witness`, которое не включается в расчёт стандартного размера блока.

2. **Изменение структуры блока**:
   - Блок теперь делится на:
     - Основную часть (Base): содержит входы и выходы транзакции.
     - Данные подписи (Witness): отдельная секция для подписей.

3. **Как это связано с размером блока?**
   - SegWit изменяет способ расчёта размера блока:
     - Ранее размер блока ограничивался 1 МБ.
     - С SegWit вводится метрика **вес блока**, которая учитывает Base и Witness части с разными коэффициентами.

---

### Весовая модель

1. **Что такое вес блока?**
   - Вес блока — это сумма весов всех транзакций, где Base и Witness части учитываются с разными коэффициентами:
     $$
     Weight = size_{base} \times 3 + size_{witness}
     $$

2. **Эффективный размер блока**:
   - Максимальный вес блока: 4 млн "весовых единиц".
   - Base часть (без Witness) учитывается с весом \( 3:1 \) по сравнению с Witness.
   - Это позволяет эффективный размер блока увеличиться до 4 МБ, так как Witness данные занимают меньший "вес".

3. **Пример**:
   - До SegWit:
     - Блок содержал только Base часть транзакции, ограничиваясь 1 МБ.
   - С SegWit:
     - Witness данные выносятся в отдельную секцию, их вес уменьшен в расчётах.
     - Это даёт возможность включить больше транзакций в блок.

---

### Как SegWit увеличивает пропускную способность?

1. **Уменьшение значимости подписи**:
   - До SegWit подписи занимали значительное место в блоке.
   - SegWit переносит подписи в Witness, что снижает их влияние на общий вес блока.

2. **Пример расчёта веса транзакции**:
   - Транзакция до SegWit:
     - Размер: 400 байт.
   - Транзакция с SegWit:
     - Base часть: 200 байт.
     - Witness часть: 200 байт.
     - Вес:
       $$
       Weight = (200 \times 3) + 200 = 800
       $$
     - Без SegWit такая транзакция занимала бы 1200 весовых единиц, тогда как с SegWit она занимает только 800.

3. **Итог**:
   - Снижение веса транзакций позволяет включать больше операций в блок.
   - Эффективный размер блока увеличивается с 1 МБ до ~4 МБ.

---

### Почему важно увеличение размера?

1. **Масштабируемость**:
   - SegWit позволяет увеличить количество транзакций, обрабатываемых в одном блоке.

2. **Экономия средств**:
   - Транзакции с SegWit занимают меньше "веса", что снижает их комиссии.

3. **Совместимость**:
   - SegWit сохраняет обратную совместимость, так как старые узлы могут игнорировать Witness данные.

---

## Примечания

- **Base часть** транзакции: основная структура, без подписи.
- **Witness часть**: содержит подпись и публичный ключ.
- **Witness** данные хранятся в конце блока и учитываются с меньшим весом.
- 

Этот подход позволяет включать больше транзакций в блок и поддерживать масштабируемые решения, такие как Lightning Network.

---

### Связанные темы
- [[Как Public Key и Private Key связан с UTXO?]]
- [[Используется ли MerkleTree в блоке? Если да, то для чего?]]
- [[Какую математическую задачку решают майнеры в POW консенсусе? Что конкретно они делают и какие критерии правильности решения задачи?]]

---

### Источники
1. [Bitcoin Developer Guide: SegWit](https://bitcoin.org/en/developer-guide#segregated-witness)
2. [SegWit Overview](https://en.bitcoin.it/wiki/Segregated_Witness)
3. [How SegWit Improves Bitcoin](https://medium.com/coinmonks/segregated-witness-segwit-explained-5e347e7527ea)