
**Короткий ответ**: Mempool (Memory Pool) — это область памяти узлов сети Bitcoin, где хранятся неподтверждённые транзакции, ожидающие включения в блок. Узлы используют mempool для обработки транзакций до их подтверждения майнерами.

---

## Подробный разбор

### Основная идея
Mempool — это временное хранилище для транзакций, которые были проверены узлом на валидность, но ещё не добавлены в блок. Транзакции остаются в mempool, пока майнеры не включат их в новый блок.

---

### Как работает mempool?

1. **Получение транзакции**:
   - Когда пользователь отправляет транзакцию, она транслируется в сеть.
   - Узлы проверяют её на корректность:
     - Соответствие правилам консенсуса.
     - Валидность цифровой подписи.
     - Достаточность средств на входах.

2. **Добавление в mempool**:
   - После проверки узел добавляет транзакцию в свой mempool.
   - Транзакция занимает место до тех пор, пока её не обработает майнер.

3. **Очистка mempool**:
   - Когда транзакция включается в блок, она удаляется из mempool всех узлов.
   - Если транзакция слишком долго остаётся неподтверждённой (например, из-за низкой комиссии), она может быть удалена.

---

### Структура данных в mempool
1. **Структура данных**:
   - В Bitcoin mempool обычно реализован как хэш-таблица, где:
     - Ключ — уникальный идентификатор транзакции (TXID).
     - Значение — сама транзакция, включая входы, выходы и комиссию.
   - Дополнительно используется очередь или бинарная куча для сортировки транзакций по комиссии.

2. **Приоритет**:
   - Транзакции с более высокими комиссиями обрабатываются в первую очередь.
   - Mempool отслеживает зависимые транзакции (child-pays-for-parent) для обеспечения корректного порядка включения.

---

### Как обеспечивается распределённость?
1. **Синхронизация между узлами**:
   - Узлы транслируют неподтверждённые транзакции друг другу через p2p-сеть.
   - Транзакция добавляется в mempool каждого узла, если она валидна.

2. **Локальное управление**:
   - У каждого узла mempool работает независимо, что позволяет учитывать локальные ограничения (например, объём памяти).

3. **Консенсус**:
   - Транзакция считается подтверждённой только после добавления в блок, что синхронизируется на уровне всей сети.

---

### Постоянное или временное хранилище?
- **Временное**:
   - Mempool не сохраняется между перезапусками узлов.
   - Это буфер, используемый для обработки транзакций до их включения в блок.

---

### Реализация mempool в Bitcoin и Ethereum

1. **Bitcoin**:
   - Используется хэш-таблица для хранения транзакций.
   - Транзакции сортируются по комиссии с учётом child-pays-for-parent.
   - Mempool очищается автоматически:
     - При заполнении блоков.
     - При превышении лимитов памяти узла.

2. **Ethereum**:
   - В Ethereum используется аналог mempool, называемый **txpool**.
   - В отличие от Bitcoin, транзакции сортируются не только по комиссии, но и по приоритету nonce:
     - Транзакции с более низким nonce имеют приоритет.
   - Узлы могут временно отложить обработку транзакций с неправильным nonce.

---

### Зачем нужен mempool?
1. **Буфер для транзакций**:
   - Mempool позволяет временно хранить транзакции, обеспечивая их обработку в порядке приоритетности (по комиссии).

2. **Обмен информацией между узлами**:
   - Узлы используют mempool для синхронизации транзакций, чтобы майнеры имели доступ к последним операциям.

3. **Оптимизация майнинга**:
   - Майнеры выбирают транзакции из mempool с самыми высокими комиссиями, чтобы максимизировать прибыль.

---

### Связанные темы
- [[Как происходит создание блока?]]
- [[Структура транзакций, какие поля имеются и для чего нужны?]]
- [[За счет чего достигается неизменность данных в блокчейне?]]

---

### Источники
1. [Документация Bitcoin](https://bitcoin.org/en/developer-guide#block-chain-overview)
2. [Bitcoin Wiki: Memory Pool](https://en.bitcoin.it/wiki/Mempool)
3. [Ethereum Documentation: Transaction Pool](https://ethereum.org/en/developers/docs/transactions/)