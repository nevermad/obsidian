
**Короткий ответ**: Для проверки блока необходимо удостовериться в корректности его заголовка, структуры транзакций, хэшей, а также соблюдении правил консенсуса. Основные параметры включают: хэш предыдущего блока, Merkle Root, временную метку, сложность, nonce и валидность транзакций.

---

## Подробный разбор

### Параметры блока для проверки

1. **Заголовок блока (Block Header)**:
   - **Хэш предыдущего блока**:
     - Должен совпадать с хэшем предыдущего блока в цепочке.
   - **Merkle Root**:
     - Проверяется путём повторного построения дерева Меркла из транзакций.
   - **Временная метка (Timestamp)**:
     - Должна быть в пределах разумного времени (например, не больше, чем на 2 часа вперёд от локального времени узла).
   - **Сложность (Bits)**:
     - Убедиться, что хэш заголовка блока соответствует текущей сложности сети.
   - **Nonce**:
     - Проверяется как часть Proof of Work (результат хэша должен быть меньше target).

2. **Транзакции**:
   - **Формат транзакций**:
     - Должен соответствовать спецификации (например, правильная структура inputs/outputs).
   - **Валидность подписей**:
     - Проверить цифровые подписи для каждой транзакции (см. [[Как Public Key и Private Key связан с UTXO?]]).
   - **Баланс входов и выходов**:
     - Общая сумма входов должна быть равна или превышать сумму выходов плюс комиссия.

---

### Этапы проверки блока

1. **Проверка хэша заголовка**:
   - Вычислить SHA-256 хэш заголовка блока.
   - Убедиться, что хэш соответствует текущему уровню сложности.

2. **Проверка связи с предыдущим блоком**:
   - Хэш предыдущего блока в текущем заголовке должен совпадать с хэшем последнего блока цепочки.

3. **Проверка Merkle Root**:
   - Построить Merkle Tree из транзакций.
   - Убедиться, что Merkle Root в заголовке блока соответствует корню дерева.

4. **Проверка транзакций**:
   - Проверить каждую транзакцию на валидность:
     - Цифровая подпись.
     - Наличие непотраченных выходов ([[UTXO]]).
     - Корректность структуры.

5. **Проверка временной метки**:
   - Убедиться, что временная метка блока находится между временем создания предыдущего блока и текущим временем узла (с учётом допустимого отклонения).

6. **Проверка сложности (Difficulty)**:
   - Убедиться, что хэш блока меньше target, определяемого сложностью.

---

### Пример проверки
1. **Заголовок**:
   - Хэш предыдущего блока: `abc123`.
   - Merkle Root: `9b0fc9...`.
   - Nonce: `293847`.
   - Временная метка: `1678493029`.

2. **Транзакции**:
   - Первая транзакция (coinbase): награда майнера.
   - Последующие транзакции: проверка подписей и соответствия правилу UTXO.

---

### Алгоритм для node-client

1. Получить новый блок из сети.
2. Проверить заголовок:
   - Связь с предыдущим блоком.
   - Валидность хэша.
   - Корректность Merkle Root.
3. Проверить транзакции.
4. Если все проверки успешны, добавить блок в локальную цепочку.

---

### Связанные темы
- [[Структура блока, какие поля имеются и для чего нужны?]]
- [[Как происходит создание блока?]]
- [[Какую математическую задачку решают майнеры в POW консенсусе? Что конкретно они делают и какие критерии правильности решения задачи?]]

---

### Источники
1. [Bitcoin Developer Guide: Block Validation](https://bitcoin.org/en/developer-guide#block-chain-overview)
2. [How to Validate Bitcoin Blocks](https://en.bitcoin.it/wiki/Block)
3. [Node Development Basics](https://www.coindesk.com/learn/how-to-build-a-bitcoin-node)