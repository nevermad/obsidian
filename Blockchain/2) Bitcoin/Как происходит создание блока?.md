
**Короткий ответ**: Создание блока включает сбор транзакций из mempool, их валидацию, вычисление заголовка блока с нужным хэшем (Proof of Work или аналог), и добавление нового блока в цепочку. В сети Proof of Work (например, Bitcoin) майнеры решают криптографическую задачу, чтобы найти подходящий хэш.

---

## Подробный разбор

### Основные шаги создания блока

1. **Сбор транзакций**:
   - Узел выбирает транзакции из [[mempool]], давая приоритет тем, у которых выше комиссии.
   - Проверяется валидность каждой транзакции:
     - Достаточно ли средств на входах.
     - Корректность цифровых подписей.
     - Соответствие правилу консенсуса.

2. **Формирование блока**:
   - Собранные транзакции упаковываются в блок, который состоит из:
     - **Заголовка блока (Block Header)**:
       - Хэш предыдущего блока.
       - Merkle Root транзакций (см. [[Используется ли MerkleTree в блоке? Если да, то для чего?]]).
       - Временная метка.
       - Nonce (в Proof of Work).
     - **Списка транзакций**.

3. **Решение криптографической задачи** (в PoW):
   - Майнер изменяет **nonce** в заголовке блока, пока хэш заголовка не станет меньше текущего **target** (см. [[Difficulty & Target в чем отличие?]]).
   - В Ethereum (Proof of Stake) валидаторы вместо майнеров проверяют блоки, основываясь на своём стейке.

4. **Добавление блока в цепочку**:
   - Когда подходящий хэш найден, блок транслируется в сеть.
   - Узлы сети проверяют блок, включая его транзакции и хэш.
   - После проверки блок добавляется в блокчейн.

---

### Особенности создания блока в Bitcoin
- Время создания блока — ~10 минут (см. [[Время создания блока Bitcoin & Ethereum? Ваши мысли почему такое время?]]).
- Используется алгоритм SHA-256 для хэширования.
- Комиссии за транзакции и награда за блок передаются в coinbase-транзакцию (см. [[Что такое пулы майнинга? Как они работают?]]).

### Особенности создания блока в Ethereum
- Время блока — ~12 секунд.
- Используется лимит газа (Gas Limit), который регулирует, сколько транзакций может быть включено.
- Proof of Stake с выбором валидатора для формирования нового блока.

---

### Связанные темы
- [[Какую математическую задачку решают майнеры в POW консенсусе? Что конкретно они делают и какие критерии правильности решения задачи?]]
- [[Nonce 4 байт, значения могут быть от 0 to 4,294,967,295. Что делать если перебрали все nonce, но не решили математическую задачку?]]
- [[Что такое пулы майнинга? Как они работают?]]
- [[За счет чего достигается неизменность данных в блокчейне?]]

---

### Источники
1. [Bitcoin Developer Guide: Blocks](https://bitcoin.org/en/developer-guide#blocks)
2. [Ethereum Documentation](https://ethereum.org/en/developers/docs/blocks/)