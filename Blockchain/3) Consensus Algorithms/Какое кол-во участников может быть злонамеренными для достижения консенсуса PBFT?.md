[Вернуться к списку вопросов](3.%20Список%20вопросов)
## Короткий ответ

Для достижения консенсуса в **PBFT (Practical Byzantine Fault Tolerance)** система может выдерживать до \( f \) злонамеренных узлов, где $$ N = 3f + 1 $$, а \( N \) — общее количество узлов. Это значит, что до одной трети узлов могут быть злонамеренными, и система всё равно сохранит корректность.

---

## Подробный разбор

### Основное правило PBFT

1. **Количество узлов**:
   - Для достижения консенсуса требуется минимум $$ N = 3f + 1 $$ узлов, где \( f \) — количество возможных злонамеренных узлов.
   - Честных узлов в системе:
     $$
     Honest = N - f = 2f + 1
     $$

2. **Обеспечение безопасности**:
   - Если \( f \) узлов злонамеренные, оставшиеся \( 2f + 1 \) честных узлов гарантируют согласованность решения.

3. **Пример**:
   - Если $$ N = 7 $$:
     - Максимум:
       $$
       f = \lfloor \frac{7 - 1}{3} \rfloor = 2
       $$
     - Честных узлов:
       $$
       Honest = N - f = 7 - 2 = 5
       $$

---

### Почему именно $$ f \leq \frac{N - 1}{3} $$?

1. **Достижение кворума**:
   - Чтобы достичь согласия, честные узлы должны образовать большинство:
     $$
     Honest = 2f + 1 > f
     $$

2. **Безопасность**:
   - Если \( f > \frac{N - 1}{3} \), злонамеренные узлы могут нарушить согласие, так как их количество станет сопоставимым с честными узлами.

3. **Устойчивость к атаке**:
   - PBFT может гарантировать корректность работы, если злонамеренные узлы не превышают одной трети от общего числа.

---

### Пример системы с PBFT

1. **Сценарий**:
   - В системе $$ N = 10 $$ узлов:
     - Максимум:
       $$
       f = \lfloor \frac{10 - 1}{3} \rfloor = 3
       $$
     - Честных узлов:
       $$
       Honest = N - f = 10 - 3 = 7
       $$

2. **Действия PBFT**:
   - Честные узлы отправляют друг другу сообщения, создавая кворум.
   - Злонамеренные узлы могут отправлять ложные сообщения, но их недостаточно для нарушения согласия.

---

### Ограничения PBFT

1. **Коммуникационные издержки**:
   - Каждый узел должен отправить сообщения всем другим узлам, что создаёт значительные накладные расходы при большом \( N \).

2. **Низкая масштабируемость**:
   - Из-за высокой сложности коммуникации PBFT эффективен только в небольших сетях.

3. **Зависимость от точности предположений**:
   - Если количество злонамеренных узлов превышает \( f \), система теряет устойчивость.

---

### Применение PBFT в блокчейне

1. **Корпоративные сети**:
   - Используется в частных блокчейнах, где количество узлов ограничено и известны участники (например, Hyperledger Fabric).

2. **Proof of Stake**:
   - Механизмы PBFT интегрируются в алгоритмы консенсуса PoS, обеспечивая устойчивость к атакам.

---

### Связанные темы

- [[Почему нельзя достигнуть консенсуса PBFT когда злонамеренных нод > 1 / 3 ?]]
- [[Перечислите предположения PBFT. Опишите потенциальные проблемы, которые могут произойти если пренебречь любым из предположений.]]
- [[Как BFT применяется в блокчейне? Соотнесите сущности блокчейна системы с ролями или действиями BFT.]]

---

### Источники

1. [PBFT Explained](https://medium.com/consensus-algorithms/practical-byzantine-fault-tolerance-explained-69256cf5e648)
2. [Byzantine Fault Tolerance Basics](https://jepsen.io/)
3. [Understanding PBFT in Blockchain](https://blockchainhub.net/)

---