[Вернуться к списку вопросов](3.%20Список%20вопросов)

## Короткий ответ

Проблема последовательного принятия предложений заключается в том, что узлы распределённой системы могут обрабатывать предложения (proposals) в разном порядке, из-за чего состояние системы становится несогласованным. Это приводит к расхождению данных между узлами и необходимости разрешения конфликтов.

---

## Подробный разбор

### Что такое последовательное принятие предложений?

1. **Суть процесса**:
   - В распределённых системах узлы обрабатывают предложения для изменения общего состояния (например, обновления базы данных или подтверждения транзакции).
   - Каждое предложение (proposal) может быть обработано в разном порядке на разных узлах.

2. **Последствия**:
   - Несогласованное состояние, так как узлы фиксируют изменения в разной последовательности.
   - Узлы могут принять разные решения о текущем состоянии системы.

---

### Пример проблемы

1. **Сценарий**:
   - Узел A отправляет предложение **Propose A**.
   - Узел B отправляет предложение **Propose B**.
   - Из-за сетевой задержки узлы получают предложения в разном порядке:
     - Узел X: обрабатывает **Propose A** → **Propose B**.
     - Узел Y: обрабатывает **Propose B** → **Propose A**.

2. **Результат**:
   - Узел X фиксирует одно состояние, а узел Y — другое.

---

### Почему это проблема?

1. **Нарушение согласованности**:
   - Если узлы системы имеют разное состояние, система больше не может гарантировать корректную работу.

2. **Риск потери данных**:
   - Одно из состояний может быть потеряно или затёрто из-за конфликта.

3. **Неопределённость**:
   - Клиенты, обращающиеся к разным узлам, могут получать разные ответы на один и тот же запрос.

---

### Решение проблемы

1. **Использование консенсус алгоритмов**:
   - Алгоритмы, такие как Paxos, Raft или PBFT, позволяют узлам договориться о порядке выполнения предложений.

2. **Упорядочивание предложений**:
   - Введение глобального порядка, например, с помощью **Lamport Timestamp** (см. [[Что такое Lamport timestamp, Lamport clock?]]).

3. **Кворум**:
   - Решения принимаются только после достижения согласия среди большинства узлов (см. [[Что такое Quorum?]]).

4. **Конфликт-устойчивые механизмы**:
   - Например, использование CRDT (Conflict-Free Replicated Data Types) для автоматического разрешения конфликтов.

---

### Связанные темы

- [[Можно ли использовать время из нод для сортировки proposal? Ответ детализируйте.]]
- [[Как решить проблему конфликтов?]]
- [[Что такое Lamport timestamp, Lamport clock?]]

---

### Источники

1. [Distributed Systems Design Basics](https://distributed-systems.net)
2. [Paxos Explained](https://lamport.azurewebsites.net/pubs/paxos-simple.pdf)
3. [Consistency and Conflict Resolution](https://jepsen.io/)

---