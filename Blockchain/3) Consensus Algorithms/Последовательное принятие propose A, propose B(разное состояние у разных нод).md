[Вернуться к списку вопросов](3.%20Список%20вопросов)
## Короткий ответ

Разное состояние узлов при последовательном принятии предложений возникает из-за отсутствия глобального порядка обработки событий в распределённой системе. Это приводит к несогласованности, когда разные узлы фиксируют противоречивые состояния.

---

## Подробный разбор

### Суть проблемы

1. **Что происходит?**
   - В распределённой системе два предложения (Propose A и Propose B) поступают на узлы.
   - Из-за сетевых задержек или других факторов узлы обрабатывают предложения в разной последовательности.

2. **Пример**:
   - Узел 1 обрабатывает:
     - Сначала Propose A, затем Propose B.
   - Узел 2 обрабатывает:
     - Сначала Propose B, затем Propose A.

3. **Результат**:
   - Узел 1 имеет состояние \( S_1 \).
   - Узел 2 имеет состояние \( S_2 \), которое отличается от \( S_1 \).

---

### Проблемы, возникающие при разном порядке обработки

1. **Несогласованность**:
   - Узлы системы могут предоставлять разные ответы на запросы.

2. **Потеря данных**:
   - Если узлы принимают противоположные состояния, одно из них может быть утеряно.

3. **Конфликты**:
   - Требуется дополнительный механизм для определения, какое состояние является корректным.

---

### Решение проблемы

1. **Упорядочивание событий**:
   - Все предложения фиксируются в едином порядке, согласованном между узлами.

2. **Использование меток времени**:
   - Каждое предложение маркируется меткой времени. Узлы обрабатывают предложения в порядке этих меток.
   - Подробнее см. [[Что такое Lamport timestamp, Lamport clock?]].

3. **Консенсус алгоритмы**:
   - Используются алгоритмы вроде Paxos или Raft для достижения единого порядка принятия предложений.
   - Все узлы соглашаются на порядок Propose A → Propose B или наоборот.

4. **Кворум для принятия решений**:
   - Решение принимается только после согласия большинства узлов (см. [[Что такое Quorum?]]).

5. **Резолверы конфликтов**:
   - Вводятся дополнительные правила разрешения конфликта. Например:
     - Последнее предложение всегда приоритетнее.
     - Выбирается предложение с наименьшей меткой времени.

---

### Пример работы консенсуса

1. **Алгоритм Raft**:
   - Все предложения фиксируются в журнале (log) узлов в одном и том же порядке.
   - Если один из узлов пытается обработать предложение вне порядка, система синхронизирует журналы.

2. **Paxos**:
   - Предложения принимаются только после согласования с большинством узлов, что предотвращает расхождения.

---

### Связанные темы

- [[Опишите суть проблемы последовательного принятия предложений?]]
- [[Как решить проблему конфликтов?]]
- [[Что такое Lamport timestamp, Lamport clock?]]
- [[Расскажите о механизме работы консенсуса Paxos. Какие основные роли и взаимодействие?]]

---

### Источники

1. [Distributed Systems Theory](https://distributed-systems.net)
2. [Raft Consensus Algorithm](https://raft.github.io/)
3. [Paxos Made Simple](https://lamport.azurewebsites.net/pubs/paxos-simple.pdf)

---