[Вернуться к списку вопросов](3.%20Список%20вопросов)
## Короткий ответ

На каждом этапе PBFT узлы проходят следующие шаги:
1. **Pre-Prepare** — лидер отправляет предложение.
2. **Prepare** — узлы делятся результатами проверки.
3. **Commit** — узлы подтверждают результаты и фиксируют блок.
4. **Reply** — клиент получает подтверждение.

---

## Подробный разбор

### Фаза 1: Pre-Prepare

1. Лидер (primary) инициирует предложение.
2. Сообщение включает:
   $$
   \{view, sequence, request\}
   $$
3. Узлы проверяют корректность сообщения:
   - Подпись.
   - Согласование с предыдущими состояниями.

---

### Фаза 2: Prepare

1. Узлы делятся результатами проверки с другими участниками.
2. Каждое сообщение Prepare подтверждает:
   - Соответствие данных предложению.
   - Возможность достичь согласия.
3. Кворум для перехода на следующую фазу:
   $$
   2f + 1
   $$

---

### Фаза 3: Commit

1. Узлы фиксируют согласие:
   - Проверяют достаточное количество Prepare сообщений.
   - Отправляют сообщение Commit другим узлам.
2. Когда большинство узлов отправляет Commit:
   $$
   Honest = 2f + 1
   $$
   блок считается зафиксированным.

---

### Фаза 4: Reply

1. Узлы отправляют подтверждение клиенту.
2. Клиент принимает результат, если получает \( 2f + 1 \) Reply сообщений.

---

### Пример

1. Лидер предлагает блок с транзакциями.
2. Узлы проверяют блок, отправляют Prepare, затем Commit.
3. После достижения кворума клиент получает подтверждение.

---

### Связанные темы

- [[Расскажите о механизме работы консенсуса PBFT. Какие есть фазы?]]
- [[Что такое BFT (как метрика)?]]
- [[Почему нельзя достигнуть консенсуса PBFT когда злонамеренных нод > 1 / 3 ?]]

---

### Источники

1. [PBFT Explained](https://blockgeeks.com/what-is-pbft/)
2. [PBFT Mechanisms](https://cointelegraph.com/explained/practical-byzantine-fault-tolerance-explained)
3. [Distributed Consensus Systems](https://distributed-systems.net)

---