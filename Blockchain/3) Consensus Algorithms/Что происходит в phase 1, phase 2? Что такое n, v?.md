---
tags: [блокчейн, распределенные-системы, paxos, консенсус, алгоритмы-консенсуса, prepare-phase, accept-phase]
aliases: [фазы Paxos, этапы Paxos, Paxos prepare, Paxos accept]
---

## Короткий ответ:

В Paxos, Phase 1 (Prepare) предназначена для выбора предложения с наибольшим номером (n),  а Phase 2 (Accept) - для принятия значения (v) этого предложения. `n` - это уникальный идентификатор предложения, `v` - предлагаемое значение для согласования.

## Подробный разбор:

**Paxos** - это алгоритм консенсуса, используемый в распределенных системах для достижения соглашения о едином значении. Он состоит из двух основных фаз:  Prepare и Accept.  Целью этих фаз является обеспечение того, чтобы только одно значение было выбрано и принято большинством узлов, даже при наличии сбоев.

**Phase 1: Prepare (Подготовка):**

1. **Proposer (предлагающий):**  Выбирает номер предложения `n`, который должен быть **больше любого номера**, использованного им ранее.  Это гарантирует уникальность предложения.
2. **Отправка запроса Prepare:** Proposer отправляет сообщение Prepare  всем Acceptors (принимающим) с номером `n`.
3. **Ответ Acceptor:**
    * Если `n` больше любого номера предложения, которое Acceptor уже принял (обещал принять - promised),  Acceptor отправляет Proposer сообщение **Promise**,  обещая не принимать предложения с номерами меньше `n`.
    * Вместе с Promise, Acceptor также отправляет Proposer информацию о **ранее принятом значении (v)**, если такое значение существует.  Это нужно для того, чтобы Proposer мог учесть ранее принятые решения.

**Phase 2: Accept (Принятие):**

1. **Выбор значения:**  Если Proposer получает Promise от большинства Acceptors, он выбирает значение `v` для предложения.
   * Если ни один из Acceptors не принял ранее никакого значения, Proposer может предложить **любое значение**.
   * Если какой-то Acceptor уже принял значение, Proposer **должен использовать это значение**  в своем предложении.  Это предотвращает конфликты и гарантирует согласованность.
2. **Отправка запроса Accept:** Proposer отправляет сообщение Accept всем Acceptors с номером предложения `n` и значением `v`.
3. **Ответ Acceptor:**  Если `n` не меньше, чем номер последнего Promise, данного Acceptor,  Acceptor принимает значение `v` и отправляет сообщение **Accepted** Proposer.


**Почему это работает:**

Двухфазный подход Paxos гарантирует, что только одно значение может быть выбрано в любой момент времени.  Требование использовать наибольший номер предложения и правило выбора значения в Phase 2 предотвращают конфликты и обеспечивают согласованность.


## Связанные темы:

* [[Расскажите о механизме работы консенсуса Paxos. Какие основные роли и взаимодействие?]]
* [[Что такое Quorum?]]
* [[Опишите суть проблемы последовательного принятия предложений?]]
* [Вернуться к списку вопросов](3.%20Список%20вопросов)


## Источники:

* [Paxos Made Simple](https://lamport.azurewebsites.net/pubs/paxos-simple.pdf)