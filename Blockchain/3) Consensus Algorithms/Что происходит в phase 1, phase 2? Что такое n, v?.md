[Вернуться к списку вопросов](3.%20Список%20вопросов)
## Короткий ответ

В **Phase 1 (Prepare)** Proposer запрашивает готовность Acceptors принять предложение с номером \( n \). В **Phase 2 (Accept)** Proposer отправляет само предложение с номером \( n \) и значением \( v \), и Acceptors голосуют за его принятие. Номер \( n \) — это уникальный идентификатор предложения, а \( v \) — значение, которое согласовывается.

---

## Подробный разбор

### Разделение фаз в Paxos

#### Phase 1: Prepare (подготовка)

1. **Инициация**:
   - Proposer отправляет запрос Prepare с номером \( n \) всем Acceptors.

2. **Ответ Acceptors**:
   - Если $$ n > n_{max} $$, где \( n_{max} \) — наибольший ранее виденный номер, Acceptor:
     - Отправляет Promise — обязательство не принимать предложения с номерами \( < n \).
     - Возвращает последнее принятое значение \( v_{accepted} \), если оно есть.

#### Phase 2: Accept (принятие)

1. **Инициация**:
   - Proposer отправляет запрос Accept с \( n \) и \( v \) (либо новым, либо последним согласованным).

2. **Ответ Acceptors**:
   - Acceptor принимает предложение, если \( n \geq n_{max} \), обновляя свои \( n_{max} \) и \( v_{accepted} \).

3. **Результат**:
   - Если большинство Acceptors приняли предложение, оно считается согласованным.

---

### Термины \( n \) и \( v \)

1. **\( n \) (номер предложения)**:
   - Уникальный идентификатор каждого предложения.
   - Используется для упорядочивания предложений.
   - Чем больше \( n \), тем выше приоритет предложения.

2. **\( v \) (значение предложения)**:
   - Конкретное значение, которое предлагается для согласования.
   - Например, обновление данных или выбор определённого состояния.

---

### Пример работы

#### Сценарий

1. Proposer хочет предложить значение \( v = "Update X" \).
2. Три узла: A, B, C.

#### Phase 1 (Prepare)

1. Proposer отправляет Prepare с \( n = 1 \).
2. Узлы A, B, C:
   - Проверяют \( n > n_{max} \) (предположим, \( n_{max} = 0 \)).
   - Отправляют Promise с \( n = 1 \) и текущим \( v_{accepted} \) (если есть).

#### Phase 2 (Accept)

1. Proposer отправляет Accept с \( n = 1 \) и \( v = "Update X" \).
2. Узлы A, B, C:
   - Проверяют $$ n \geq n_{max} $$
   - Обновляют \( n_{max} = 1 \), \( v_{accepted} = "Update X" \).
3. После получения большинства голосов значение \( v = "Update X" \) считается согласованным.

---

### Связанные темы

- [[Расскажите о механизме работы консенсуса Paxos. Какие основные роли и взаимодействие?]]
- [[Что такое Quorum?]]
- [[Опишите суть проблемы последовательного принятия предложений?]]

---

### Источники

1. [Paxos Made Simple](https://lamport.azurewebsites.net/pubs/paxos-simple.pdf)
2. [Distributed Consensus Algorithms](https://distributed-systems.net)
3. [Jepsen: Understanding Paxos](https://jepsen.io/)

---