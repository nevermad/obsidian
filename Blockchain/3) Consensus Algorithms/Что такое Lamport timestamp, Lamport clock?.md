---
tags: [блокчейн, распределенные-системы, lamport-timestamp, lamport-clock, упорядочивание-событий, консенсус]
aliases: [логическая метка времени, Lamport часы, временные метки]
---


## Короткий ответ:

Lamport Clock - это механизм, использующий Lamport Timestamps для определения порядка событий в распределенной системе. Lamport Timestamp - это числовая метка времени, присваиваемая каждому событию, которая отражает причинно-следственные связи между событиями.

## Подробный разбор:

**Проблема:** В распределенных системах узлы не имеют синхронизированных часов, что затрудняет определение порядка событий.

**Решение:** Lamport Clock  решает эту проблему, используя **Lamport Timestamps** и правила для их обновления.  **Lamport Clock** — это не физические часы, а **логическая конструкция**, реализованная в каждом узле распределенной системы.  Каждый **Lamport Clock** поддерживает свой собственный счетчик, который используется для генерации **Lamport Timestamps**.

**Алгоритм Lamport Clock:**

1. **Инициализация:** Каждый узел инициализирует свой счетчик (clock) значением 0.

2. **Локальное событие:** При каждом локальном событии на узле, его счетчик увеличивается на 1: `clock = clock + 1`.  Этому событию присваивается текущее значение счетчика как Lamport Timestamp.

3. **Отправка сообщения:** При отправке сообщения, узел увеличивает свой счетчик на 1: `clock = clock + 1`,  и прикрепляет текущее значение счетчика к сообщению.

4. **Получение сообщения:** При получении сообщения с timestamp `TS_message`, узел сравнивает свой текущий счетчик `clock` с  `TS_message`.
   Узел обновляет свой счетчик по следующему правилу: `clock = max(clock, TS_message) + 1`.


**Пример:**

| Узел A | Узел B |
|---|---|
| Событие 1 (T=1) |  |
| Отправка сообщения (T=2)  |  |
|  | Получение сообщения (T=3) |
|  | Событие 2 (T=4) |


**Lamport Timestamp vs. Lamport Clock:**

* **Lamport Timestamp:**  Числовая метка времени, присваиваемая событию.
* **Lamport Clock:** Алгоритм и механизм, используемый для генерации и обновления Lamport Timestamps.  Можно представить себе **Lamport Clock** как функцию, которая принимает событие в качестве входных данных и возвращает **Lamport Timestamp** в качестве выходных данных.


**Ограничения Lamport Clock:**

* **Неполный порядок:** Lamport Clock не может определить, произошли ли два события одновременно или нет, если между ними нет причинно-следственной связи. Для решения этой проблемы используются Vector Clocks.  Lamport Clock устанавливает только **частичный порядок** событий.


## Связанные темы:

* [[Можно ли использовать время из нод для сортировки proposal? Ответ детализируйте.]]
* [[Как решить проблему конфликтов?]]
* [[Расскажите о механизме работы консенсуса Paxos. Какие основные роли и взаимодействие?]]
* [Вернуться к списку вопросов](3.%20Список%20вопросов)
## Источники:

* [Lamport's Time, Clocks, and the Ordering of Events in a Distributed System](https://lamport.azurewebsites.net/pubs/time-clocks.pdf)