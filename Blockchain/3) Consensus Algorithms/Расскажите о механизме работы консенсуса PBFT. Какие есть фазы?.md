[Вернуться к списку вопросов](3.%20Список%20вопросов)
## Короткий ответ

**PBFT (Practical Byzantine Fault Tolerance)** работает в четыре фазы:
1. **Pre-Prepare** — лидер (primary) инициирует предложение.
2. **Prepare** — узлы проверяют предложение и делятся своим согласием.
3. **Commit** — узлы фиксируют согласие и подтверждают блок.
4. **Reply** — результат передаётся клиенту.

---

## Подробный разбор

### Фазы PBFT

1. **Pre-Prepare (Предварительная подготовка)**:
   - Лидер (primary) отправляет всем узлам сообщение с предложением (propose).
   - Сообщение включает:
     $$
     \{view, sequence, request\}
     $$
   - \( view \) — текущий раунд (итерация консенсуса).
   - \( sequence \) — номер операции.
   - \( request \) — данные для согласования.

2. **Prepare (Подготовка)**:
   - Узлы проверяют сообщение:
     - Корректность данных.
     - Соответствие текущему состоянию.
   - Если проверка успешна, узлы отправляют сообщение Prepare другим участникам.

3. **Commit (Фиксация)**:
   - После получения большинства Prepare сообщений узлы переходят в фазу Commit.
   - Отправляется сообщение Commit другим узлам.
   - Узлы фиксируют блок, когда получают большинство Commit сообщений.

4. **Reply (Ответ)**:
   - Узлы отправляют подтверждение клиенту.
   - Клиент принимает результат, когда получает \( 2f + 1 \) Reply сообщений.

---

### Пример работы PBFT

1. **Инициирование**:
   - Лидер отправляет предложение согласовать блок с транзакциями.

2. **Подготовка**:
   - Узлы проверяют блок и делятся результатами с другими участниками.

3. **Фиксация**:
   - После достижения кворума (\( 2f + 1 \) сообщений) блок фиксируется.

4. **Ответ клиенту**:
   - Клиент получает подтверждение о включении блока.

---

### Связанные темы

- [[Перечислите предположения PBFT. Опишите потенциальные проблемы, которые могут произойти если пренебречь любым из предположений.]]
- [[Как BFT применяется в блокчейне? Соотнесите сущности блокчейна системы с ролями или действиями BFT.]]
- [[Что такое финализация?]]

---

### Источники

1. [PBFT Algorithm Overview](https://cointelegraph.com/explained/practical-byzantine-fault-tolerance-explained)
2. [PBFT Phases Explained](https://blockgeeks.com/what-is-pbft/)
3. [Distributed Systems: PBFT Basics](https://distributed-systems.net)

---