[Вернуться к списку вопросов](3.%20Список%20вопросов)
## Короткий ответ

Конфликты принятия решений в распределённой системе возникают, когда узлы фиксируют разные состояния из-за сетевых задержек, одновременной обработки предложений или частичного отказа. Примеры таких конфликтов включают дублирование данных, противоречивые записи и нарушение порядка транзакций.

---

## Подробный разбор

### Примеры конфликтов

1. **Дублирование данных**:
   - **Сценарий**:
     - Клиент отправляет запрос на запись данных одновременно на узлы A и B.
     - Узлы не синхронизированы и фиксируют дублированные записи.
   - **Последствие**:
     - Система сохраняет две записи вместо одной.

2. **Противоречивые записи**:
   - **Сценарий**:
     - Клиент 1 отправляет запрос на изменение баланса счета с \(100 \to 90\).
     - Клиент 2 одновременно отправляет запрос на изменение баланса с \(100 \to 80\).
     - Узлы обрабатывают запросы в разном порядке:
       - Узел A: \(100 \to 90 \to 80\).
       - Узел B: \(100 \to 80 \to 90\).
   - **Последствие**:
     - Узлы фиксируют разные конечные балансы (70 на узле A и 80 на узле B).

3. **Нарушение порядка транзакций**:
   - **Сценарий**:
     - Транзакция 1: пользователь отправляет 10 BTC.
     - Транзакция 2: тот же пользователь отправляет 5 BTC.
     - Узлы фиксируют транзакции в разном порядке:
       - Узел A: \( -10, -5\).
       - Узел B: \( -5, -10\).
   - **Последствие**:
     - В результате может произойти переполнение баланса или некорректные расчёты.

---

### Основные причины конфликтов

1. **Сетевые задержки**:
   - Разные узлы получают сообщения с различной скоростью, из-за чего обработка предложений нарушает порядок.

2. **Одновременные изменения**:
   - Если два клиента вносят изменения в одну и ту же запись, возникает конфликт.

3. **Отсутствие глобального времени**:
   - Узлы не синхронизированы и не могут определить правильную последовательность событий.

4. **Разделение сети (split-brain)**:
   - В результате разделения сети узлы могут принимать решения независимо, что приводит к разным состояниям.

---

### Решение проблем конфликтов

1. **Использование алгоритмов консенсуса**:
   - Алгоритмы, такие как Paxos или Raft, обеспечивают согласованный порядок принятия предложений.

2. **Синхронизация времени**:
   - Lamport Timestamp или другие метки времени позволяют упорядочить события.

3. **CRDT (Conflict-Free Replicated Data Types)**:
   - Специальные структуры данных, которые разрешают конфликты автоматически.

4. **Кворум (Quorum)**:
   - Операции выполняются только при согласии большинства узлов, что предотвращает расхождение данных.

---

### Пример: Решение проблемы с использованием Raft

1. **Сценарий**:
   - Клиент 1 отправляет запрос на изменение данных на узел A.
   - Клиент 2 отправляет другой запрос на изменение данных на узел B.

2. **Действия Raft**:
   - Узел-лидер упорядочивает запросы:
     - Запрос от клиента 1 → Запрос от клиента 2.
   - Лидер транслирует порядок запросов остальным узлам.

3. **Результат**:
   - Все узлы фиксируют одинаковый порядок изменений.

---

### Связанные темы

- [[Как решить проблему конфликтов?]]
- [[Можно ли использовать время из нод для сортировки proposal? Ответ детализируйте.]]
- [[Что такое Quorum?]]

---

### Источники

1. [Jepsen: Distributed System Testing](https://jepsen.io/)
2. [Raft Consensus Algorithm](https://raft.github.io/)
3. [Consistency in Distributed Systems](https://distributed-systems.net)

---